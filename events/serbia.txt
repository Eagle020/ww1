add_namespace = serbia

#Currently only the war chain is done; there will be alternatives later on but for playtest focus is on getting a proper WW1 start.
#This is a highly complex chain containing dozens of individual events, some of those containing multiple different possible flavor texts. This has been playtested, but I cannot guarantee nothing weird is going to happen if you try out some ahistorical choices. Bugs may be superficial (like seeing wrong flavor text) or serious (like joining war on wrong side); pls report.

#Assassination chain is supposed to have several possible outcomes and 2 possible assassins, don't be surprised if you don't get a historical result. Handled via the sar_news file.

#Immediate Austro-Hungarian reaction
country_event = {
	id = serbia.1
	title = serbia.1.t
	is_triggered_only = yes
	fire_only_once = yes
	desc = {
		text = serbia.1.d1
		trigger = { has_global_flag = Sarajevo_FF_dead }
	}
	desc = {
		text = serbia.1.d2
		trigger = { not = { has_global_flag = Sarajevo_FF_dead } }
	}
	option = {#towards war, ff dead
		name = serbia.1.a1
		trigger = { has_global_flag = Sarajevo_FF_dead }
		country_event = { id = serbia.3 days = 1 }
	}
	option = {#towards war, ff lives
		name = serbia.1.a2
		trigger = { has_global_flag = Sarajevo_FF_alive }
		country_event = { id = serbia.3 days = 1 }
	}
	
#	option = {#investigate - historical (war chain branch)
#		name = serbia.1.b
#		#trigger investigation result, continuation from there
#	}
#	option = {#diplomatic solution
#		name = serbia.1.c
#		#trigger negotiations chain
#	}
}

#successful visit, no attempt
country_event = {
	id = serbia.2
	title = serbia.2.t
	desc = serbia.2.d
	is_triggered_only = yes
	fire_only_once = yes
	option = {
		name = serbia.2.a
		army_experience = 5
	}
}

#attempt at immediate war, generals complain
country_event = {
	id = serbia.3
	title = serbia.3.t
	desc = serbia.3.d
	fire_only_once = yes
	is_triggered_only = yes
	option = {#immediate war
		name = serbia.3.a
		declare_war_on = {
			target = SER
			type = puppet_wargoal_focus
		}
		add_timed_idea = {
			idea = sar_disorganized_army_5
			days = 150
		}
		set_country_flag = sarajevo_immediate_war
		every_country = {
			limit = { is_in_faction_with = ROOT }
			set_country_flag = austrian_ally
		}
		leave_faction = yes
		set_global_flag = sarajevo_AUH_at_war
		country_event = { id = serbia.40 days = 20 }
		country_event = { id = serbia.4 days = 1 }
		news_event = { id = sar_news.4 days = 1 }
		SER = { 
			country_event = { id = serbia.5 days = 1 }
		}
		FRA = { country_event = { id = serbia.30 days = 14 } }
		RUS = { country_event = { id = serbia.30 days = 14 } }
		every_country = {
			limit = {
				not = {
					tag = FRA
					tag = RUS
				}
				has_country_flag = friend_of_serbia
			}
			country_event = { id = serbia.30 days = 14 }
		}
		ai_chance = { factor = 0 }
	}
	option = {#delay the war
		name = serbia.3.b
		country_event = { id = serbia.9 days = 1 } #austria seeking support
		country_event = { id = serbia.47 days = 14 } #ultimatum
		SER = { country_event = { id = serbia.18 days = 12 } } #serbia seeking support
		ai_chance = { factor = 1 }
	}
}

#hidden war euphoria setup for austria, visible event handled at serbia.48
country_event = { #AUH gets short time buff
	id = serbia.4
	title = serbia.4.t
	is_triggered_only = yes
	fire_only_once = yes
	hidden = yes
	desc = serbia.4.d
	immediate = {
		if = {
			limit = {
				has_country_flag = sarajevo_immediate_war
				has_global_flag = Sarajevo_FF_dead
			}
			set_country_flag = sar_high_enthusiasm
		}
		if = {
			limit = {
				OR = {
					AND = {
						has_country_flag = sarajevo_immediate_war
						not = { has_global_flag = Sarajevo_FF_dead }
					}
					AND = {
						has_global_flag = Sarajevo_FF_dead
						not = { has_country_flag = sarajevo_immediate_war }
					}
				}
			}
			set_country_flag = sar_medium_enthusiasm
		}
		if = {
			limit = {
				NOT = {
					has_country_flag = sarajevo_immediate_war
					has_global_flag = Sarajevo_FF_dead
				}
			}
			set_country_flag = sar_low_enthusiasm
		}
		country_event = { id = serbia.48 hours = 1 }
	}
}

#serbia at war
country_event = { #serbia gets buffs
	id = serbia.5
	title = serbia.5.t
	desc = serbia.5.d
	is_triggered_only = yes
	fire_only_once = yes
	option = {
		name = serbia.5.a
		add_ideas = sar_for_the_motherland
	}
}

#disorganized army gets better
country_event = {
	id = serbia.6
	title = serbia.6.t
	is_triggered_only = yes
	trigger = {
		has_war = yes
		OR = {
			has_idea = sar_disorganized_army_1
			has_idea = sar_disorganized_army_2
			has_idea = sar_disorganized_army_3
			has_idea = sar_disorganized_army_4
			has_idea = sar_disorganized_army_5
		}
	}
	desc = {
		text = serbia.6.d1
		trigger = { has_idea = sar_disorganized_army_5 }
	}
	desc = {
		text = serbia.6.d2
		trigger = { has_idea = sar_disorganized_army_4 }
	}
	desc = {
		text = serbia.6.d3
		trigger = { has_idea = sar_disorganized_army_3 }
	}
	desc = {
		text = serbia.6.d4
		trigger = { has_idea = sar_disorganized_army_2 }
	}
	desc = {
		text = serbia.6.d5
		trigger = { has_idea = sar_disorganized_army_1 }
	}
	immediate = {
		if = {
			limit = { has_idea = sar_disorganized_army_1 }
			remove_ideas = sar_disorganized_army_1
		}
		if = {
			limit = { has_idea = sar_disorganized_army_2 }
			swap_ideas = {
				add_idea = sar_disorganized_army_1
				remove_idea = sar_disorganized_army_2
			}
			country_event = { id = serbia.40 days = 40 }
		}
		if = {
			limit = { has_idea = sar_disorganized_army_3 }
			swap_ideas = {
				add_idea = sar_disorganized_army_2
				remove_idea = sar_disorganized_army_3
			}
			country_event = { id = serbia.40 days = 30 }
		}
		if = {
			limit = { has_idea = sar_disorganized_army_4 }
			swap_ideas = {
				add_idea = sar_disorganized_army_3
				remove_idea = sar_disorganized_army_4
			}
			country_event = { id = serbia.40 days = 25 }
		}
		if = {
			limit = { has_idea = sar_disorganized_army_5 }
			swap_ideas = {
				add_idea = sar_disorganized_army_4
				remove_idea = sar_disorganized_army_5
			}
			country_event = { id = serbia.40 days = 20 }
		}
	}
	option = { name = serbia.6.a }
}

#housekeeping to make sure nation is still at war when event fires
country_event = {
	id = serbia.7
	title = serbia.7.t
	desc = serbia.7.d
	is_triggered_only = yes
	hidden = yes
	immediate = {
		if = {
			limit = { has_war = yes }
			country_event = { id = serbia.8 hours = 1 }
		}
	}
	option = {
		name = serbia.7.a
	}
}

#worsening mood as campaign drags on (cancels out patriotic wave over time)
country_event = {
	id = serbia.8
	title = serbia.8.t
	is_triggered_only = yes
	desc = {
		text = serbia.8.d1
		trigger = {
			has_idea = sar_patriotic_wave_3
			not = { has_country_flag = major_victory }
		}
	}
	desc = {
		text = serbia.8.d2
		trigger = {
			has_idea = sar_patriotic_wave_2
			not = { has_country_flag = major_victory }
		}
	}
	desc = {
		text = serbia.8.d3
		trigger = {
			has_idea = sar_patriotic_wave_1
			not = { has_country_flag = major_victory }
		}
	}
	desc = {
		text = serbia.8.d4
		trigger = {
			not = {
				has_idea = sar_patriotic_wave_1
				has_idea = sar_patriotic_wave_2
				has_idea = sar_patriotic_wave_3
				has_idea = sar_patriotic_wave_4
			}
			not = { has_country_flag = major_victory }
		}
	}
	desc = {
		text = serbia.8.d5
		trigger = { has_country_flag = major_victory }
	}
	immediate = {
		if = {
			limit = { not = { has_country_flag = major_victory } }	
			if = {
				limit = { has_idea = sar_patriotic_wave_1 }
				remove_ideas = sar_patriotic_wave_1
			}
			if = {
				limit = { has_idea = sar_patriotic_wave_2 }
				swap_ideas = {
					add_idea = sar_patriotic_wave_1
					remove_idea = sar_patriotic_wave_2
				}
				country_event = { id = serbia.7 days = 90 }
			}
			if = {
				limit = { has_idea = sar_patriotic_wave_3 }
				swap_ideas = {
					add_idea = sar_patriotic_wave_2
					remove_idea = sar_patriotic_wave_3
				}
				country_event = { id = serbia.7 days = 60 }
			}
			if = {
				limit = { has_idea = sar_patriotic_wave_4 }
				swap_ideas = {
					add_idea = sar_patriotic_wave_3
					remove_idea = sar_patriotic_wave_4
				}
				country_event = { id = serbia.7 days = 60 }
			}
		}
		if = {
			limit = { has_country_flag = major_victory }
			country_event = { id = serbia.7 days = 60 }
		}
	}
	option = {
		name = serbia.8.a1
		trigger = { has_idea = sar_patriotic_wave_4 }
	}
	option = {
		name = serbia.8.a2
		trigger = { has_idea = sar_patriotic_wave_3 }
	}
	option = {
		name = serbia.8.a3
		trigger = { has_idea = sar_patriotic_wave_2 }
	}
	option = {
		name = serbia.8.a4
		trigger = {	has_idea = sar_patriotic_wave_1	}
	}
	option = {
		name = serbia.8.a5
		trigger = { has_country_flag = major_victory }
		clr_country_flag = major_victory
	}
}
			
#austria seeking support
country_event = {
	id = serbia.9
	title = serbia.9.t
	desc = serbia.9.d
	is_triggered_only = yes
	fire_only_once = yes
	option = { #seek support
		name = serbia.9.a
		every_country = { #targets faction + triple alliance majors
			limit = {
				has_country_flag = is_major_nation
				not = { tag = ROOT } #sends to self otherwise
				OR = {
					is_in_faction_with = ROOT
					has_guaranteed = ROOT
				}
			}
			country_event = { id = serbia.10 days = 1 }
			set_country_flag = sar_aus_request_undecided
		}		
		ai_chance = { factor = 1 }
	}
	option = { #fight alone
		name = serbia.9.b
		add_stability = 0.1
		set_country_flag = sar_aus_fight_alone
		ai_chance = { factor = 0 }
	}
}

#austria asks for aid
country_event = {
	id = serbia.10
	title = serbia.10.t
	is_triggered_only = yes
	desc = {
		text = serbia.10.d1
		trigger = { has_global_flag = sarajevo_FF_dead }
	}
	desc = {
		text = serbia.10.d2
		trigger = { has_global_flag = sarajevo_FF_alive }
	}
	option = {#unconditional support
		name = serbia.10.a
		set_country_flag = support_aus
		AUH = {
			country_event = { id = serbia.11 days = 1 }
            add_opinion_modifier = { modifier = sar_support target = ROOT }        
		}
		if = {
			limit = { tag = ITA }
			AUH = {
				set_country_flag = sarajevo_ita_aus_successful
			}
		}
		clr_country_flag = sar_aus_request_undecided
		ai_chance = { factor = 1 
			modifier = {
				factor = 0
				AND = {
					tag = ITA
					not = { has_country_flag = ITA_AUH_dispute_solved }
				}
			}
		}		
	}
	option = { #major, not italy, urges restraint
		name = serbia.10.c
		trigger = {
			has_country_flag = is_major_nation
			is_in_faction_with = ROOT
			not = { 
				AND = {
					tag = ITA
					NOT = { has_country_flag = ITA_AUH_dispute_solved }
				}
			}
		}
		AUH = {
			country_event = { id = serbia.12 days = 1 }
			set_country_flag = sar_major_dissent
            add_opinion_modifier = { modifier = sar_dissent target = ROOT }
		}
		clr_country_flag = sar_aus_request_undecided
		set_country_flag = sar_dissenting_major
		ai_chance = { factor = 0 }
	}
	option = {#demand territory for italians
		name = serbia.10.b
		trigger = {
			tag = ITA
			not = { has_country_flag = ITA_AUH_dispute_solved }
		}
		AUH = { 
			country_event = { id = serbia.14 days = 1 }
		}
		ai_chance = { factor = 1 }
	}
	option = {#plain refusal for triple alliance members or italy
		name = serbia.10.e
		trigger = {
			has_guaranteed = ROOT
			OR = {
				not = { is_in_faction_with = ROOT }
				AND = {
					tag = ITA
					not = { has_country_flag = ITA_AUH_dispute_solved }
				}
			}
		}
		AUH = {
			country_event = { id = serbia.12 days = 1 }
			set_country_flag = sar_major_dissent
            add_opinion_modifier = { modifier = sar_dissent target = ROOT }
		}
		set_country_flag = sar_dissenting_major
		clr_country_flag = sar_aus_request_undecided
		ai_chance = { factor = 0 }
	}
}

#carte blanche
country_event = {
	id = serbia.11
	title = serbia.11.t
	is_triggered_only = yes
	desc = serbia.11.d
	immediate = { #give austro-hungarians chance to back down if major dissent
		if = {
			limit = {
                    has_country_flag = sar_major_dissent                         
				not = {
					any_country = {
						exists = yes
						has_country_flag = sar_aus_request_undecided
					}
				}
			}
			country_event = { id = serbia.13 days = 3 }
		}
	}
	option = { #from any major other than italy
		name = serbia.11.a1
		trigger = {
			not = {
				FROM = {
					tag = ITA
					not = { has_country_flag = ITA_AUH_dispute_solved }
				}
			}
		}
	}
	option = { #from italy
		name = serbia.11.a2
		trigger = {
			FROM = {
				tag = ITA
				not = { has_country_flag = ITA_AUH_dispute_solved }
			}
		}
	}
}

	
#nation urges restraint
country_event = {
	id = serbia.12
	is_triggered_only = yes
	title = {
		text = serbia.12.t1
		trigger = {
			FROM = {
				OR = {
					not = { is_in_faction_with = ROOT }
					AND = {
						tag = ITA
						not = { has_country_flag = ITA_AUH_dispute_solved }
					}
				}
			}
		}
	}
	#start of problems
	title = {
		text = serbia.12.t2
		trigger = {
			not = {
				FROM = {
					OR = {
						not = { is_in_faction_with = ROOT }
						AND = {
							tag = ITA
							not = { has_country_flag = ITA_AUH_dispute_solved }
						}
					}
				}
			}
		}
	}				
	desc = { #for faction members
		text = serbia.12.d1
		trigger = {
			FROM = {
				is_in_faction_with = ROOT
				NOT = {
					AND = {
						tag = ITA
						not = { has_country_flag = ITA_AUH_dispute_solved }
					}
				}
			}
		}
	}
	desc = { #for guarantee givers aka triple alliance members
		text = serbia.12.d2
		trigger = {
			FROM = {
				OR = {
					not = { is_in_faction_with = ROOT }
					AND = {
						tag = ITA
						not = { has_country_flag = ITA_AUH_dispute_solved }
					}
				}
			}
		}
	}
	immediate = { #triggers event for austro-hungarians to back down if major dissent
		if = {
			limit = {
				not = {
					any_country = {
						exists = yes
						has_country_flag = sar_aus_request_undecided
					}
				}
			}
			country_event = { id = serbia.13 days = 3 }
		}
	}		
	option = {
		name = serbia.12.a
		trigger = {
			FROM = {
				tag = ITA
				not = { has_country_flag = ITA_AUH_dispute_solved }
			}
		}
	}
	option = {
		name = serbia.12.b
		trigger = {
			FROM = {
				NOT = { is_in_faction_with = ROOT }
				NOT = {
					AND = {
						tag = ITA
						not = { has_country_flag = ITA_AUH_dispute_solved }
					}
				}
			}
		}
	}
	option = {
		name = serbia.12.c
		trigger = {
			FROM = {
				is_in_faction_with = ROOT
				NOT = {
					AND = {
						tag = ITA
						not = { has_country_flag = ITA_AUH_dispute_solved }
					}
				}
			}
		}
	}
}


#austria-hungary can back down if allied majors oppose
country_event = {
	id = serbia.13
	title = serbia.13.t
	desc = serbia.13.d
	is_triggered_only = yes
	fire_only_once = yes
	option = { # do it and split the faction
		name = serbia.13.a
		if = { #is faction leader or faction leader supportive
			limit = {
				OR = {
					is_faction_leader = yes
					any_country = {
						is_in_faction_with = ROOT
						is_faction_leader = yes
						not = { has_country_flag = sar_dissenting_major }
					}
				}
			}
			every_country = { #dissenting major can form own faction
				limit = {
					is_in_faction_with = ROOT
					has_country_flag = is_major_nation
					has_country_flag = sar_dissenting_major
				}
				country_event = { id = serbia.42 days = 1 }
			}
		}
		if = { #faction leader unsupportive
			limit = {
				AND = {
					is_faction_leader = no
					any_country = {
						is_in_faction_with = ROOT
						is_faction_leader = yes
						has_country_flag = sar_dissenting_major
					}
				}
			}
			every_country = { #austria-hungary splits off
				limit = {
					OR = {
						is_in_faction_with = ROOT
						has_guaranteed = ROOT
					}
				}
				country_event = { id = serbia.41 days = 1 }
			}
			every_country = {
				limit = {
					is_in_faction_with = ROOT
					is_faction_leader = yes
				}
				add_opinion_modifier = {
					modifier = sar_alliance_breaker target = ROOT
				}
				ROOT = {
					add_opinion_modifier = {
						modifier = sar_alliance_breaker target = PREV
					}
				}
			}
			leave_faction = yes
			set_rule = { can_create_factions = yes }
			create_faction = "Vienna Pact"
		}
	}
	option = { #back down
		name = serbia.13.b
		add_timed_idea = {
			idea = nation_humiliated
			days = 200
		}
		set_country_flag = sar_AUH_backed_down
		every_country = {
			limit = {
				has_country_flag = is_major_nation
				OR = {
					is_in_faction_with = ROOT
					has_guaranteed = ROOT
				}
				NOT = { tag = ROOT }
			}
			country_event = {
				id = serbia.43 days = 1
			}
		}
	}
}

#italy wants territory

country_event = {
	id = serbia.14
	title = serbia.14.t
	desc = {
		text = serbia.14.d1
		trigger = { not = { has_global_flag = sarajevo_AUH_at_war } }
	}
	desc = {
		text = serbia.14.d2
		trigger = { has_global_flag = sarajevo_AUH_at_war }
	}
	fire_only_once = yes
	is_triggered_only = yes
	option = { #give in to their demands
		name = serbia.14.a
		ai_chance = { factor = 0 }
		set_country_flag = sarajevo_ita_aus_successful
		country_event = { id = serbia.39 days = 7 } #nice little civil war
		add_timed_idea = { #gave the italians too much
			idea = dissatisfied_public
			days = 100
		}
		ITA = { 
			country_event = { id = serbia.15 days = 1 }
			set_state_owner = 163 
			set_state_owner = 736
			set_state_owner = 835
			set_state_controller = 163
			set_state_controller = 736
			set_state_controller = 835
			add_opinion_modifier = { modifier = sar_ceded_land target = ROOT }
			set_country_flag = ITA_AUH_dispute_solved
		}
		835 = { set_state_name = "Trento" }
		if = {
			limit = {
				has_global_flag = sarajevo_AUH_at_war
			}
		}
	}
	option = { #offer trentino instead
		name = serbia.14.b
		ITA = { country_event = { id = serbia.16 days = 2 } }
		ai_chance = { factor = 1 }
	}
	option = { #give them nothing
		name = serbia.14.c
		ITA = {
			country_event = { id = serbia.17 days = 2 }
			add_opinion_modifier = { modifier = sar_refused_deal target = ROOT }
			set_country_flag = sar_dissenting_major
		}
		set_country_flag = sar_major_dissent
		ai_chance = { factor = 0 }
	}
}

#italians react to austrian concessions

country_event = {
	id = serbia.15
	title = serbia.15.t
	desc = {
		text = serbia.15.d1
		trigger = { not = { has_global_flag = sarajevo_AUH_at_war } }
	}
	desc = {
		text = serbia.15.d2
		trigger = {
			has_global_flag = sarajevo_AUH_at_war
			RUS = { has_country_flag = support_ser }
			not = { FRA = { has_country_flag = support_ser } }
		}
	}
	desc = {
		text = serbia.15.d3
		trigger = {
			has_global_flag = sarajevo_AUH_at_war
			FRA = { has_country_flag = support_ser }
			not = { RUS = { has_country_flag = support_ser } }
		}
	}
	desc = {
		text = serbia.15.d4
		trigger = {
			has_global_flag = sarajevo_AUH_at_war
			RUS = { has_country_flag = support_ser }
			FRA = { has_country_flag = support_ser }
		}
	}
	desc = { #backup
		text = serbia.15.d5
		trigger = {
			has_global_flag = sarajevo_AUH_at_war
			not = {
				RUS = { has_country_flag = support_ser }
				FRA = { has_country_flag = support_ser }
			}
		}
	}
	immediate = {
		set_country_flag = support_aus
	}
	fire_only_once = yes
	is_triggered_only = yes
	option = {
		name = serbia.15.a
		trigger = {
			not = { has_global_flag = sarajevo_AUH_at_war }
		}
	}
	option = { #join war immediately
		name = serbia.15.b
		trigger = {
			any_country = {
				has_country_flag = is_major_nation
				has_war_with = FROM
			}
		}
		add_to_war = {
			targeted_alliance = FROM
			enemy = SER
		}
		add_timed_idea = {
			idea = sar_disorganized_army_4
			days = 150
		}
		country_event = { id = serbia.40 days = 20 }
		ai_chance = { factor = 0 }
	}
	option = { #take you time and mobilize
		name = serbia.15.c
		trigger = {
			has_global_flag = sarajevo_AUH_at_war
		}
		country_event = { id = serbia.34 days = 21 }
	}
}

#italians react to austrian counter-offer

country_event = {
	id = serbia.16
	title = serbia.16.t
	desc = serbia.16.d
	fire_only_once = yes
	is_triggered_only = yes
	option = { #take it
		name = serbia.16.a
		AUH = { 
			country_event = { id = serbia.23 days = 1 }
			add_timed_idea = {
				idea = dissatisfied_public
				days = 100
			}
			add_opinion_modifier = { modifier = sar_honored_alliance target = ROOT }
			set_country_flag = sarajevo_ita_aus_successful
		}
		set_country_flag = support_aus
		add_opinion_modifier = { modifier = sar_ceded_some_land target = FROM }
		set_state_owner = 835
		set_state_controller = 835
		835 = { set_state_name = "Trento" }
		if = {
			limit = {
				has_global_flag = sarajevo_AUH_at_war
				any_country = {
					has_country_flag = is_major_nation
					has_war_with = FROM
				}
			}
			country_event = { id = serbia.29 days = 1 }
		}
		if = {
			limit = {
				has_global_flag = sarajevo_AUH_at_war
				not = {
					any_country = {
						has_country_flag = is_major_nation
						has_war_with = FROM
					}
				}
			}
			country_event = { id = serbia.34 days = 21 }
		}
		ai_chance = { factor = 0 }
	}
	option = { #refuse
		name = serbia.16.b
		AUH = {
			country_event = { id = serbia.22 days = 1 }
		}
		ai_chance = { factor = 1 }	
	}
}

#italians react to getting nothing

country_event = {
	id = serbia.17
	title = serbia.17.t
	desc = serbia.17.d
	fire_only_once = yes
	is_triggered_only = yes
	option = { #approach other side
		name = serbia.17.a
		ai_chance = { factor = 1 }
		clr_country_flag = sar_aus_request_undecided
		clr_country_flag = sar_dissenting_major
		if = {
			limit = {
				not = {
					any_country = {
						has_country_flag = sar_aus_request_undecided
					}
				}
			}
			FROM = { country_event = { id = serbia.13 days = 1 } }
		}
		if = {
			limit = {
				has_idea = triple_alliance
				any_country = {
					has_idea = triple_alliance
					is_guaranteed_by = ROOT
				}
			}
			every_country = {
				limit = {
					has_idea = triple_alliance
					is_guaranteed_by = ROOT
				}
				add_opinion_modifier = {
					modifier = sar_alliance_breaker
					target = ROOT
				}
				ROOT = {
					diplomatic_relation = {
						country = PREV
						relation = guarantee
						active = no
					}
  				}
			}
			every_country = {
				limit = {
					has_idea = triple_alliance
					has_guaranteed = ROOT
				}
				diplomatic_relation = {
					country = ROOT
					relation = guarantee
					active = no
				}
			}
		}
		if = {
			limit = { is_in_faction_with = FROM }
			leave_faction = yes
		}
		if = {
			limit = { has_idea = triple_alliance }
			remove_ideas = triple_alliance
		}
		news_event = { id = sar_news.7 days = 1 }		
	}
	option = { #no we stay where we are
		name = serbia.17.b
		ai_chance = { factor = 0 }
	}
}

#stop chain if austria-hungary bails out, otherwise fire events
country_event = {
	id = serbia.18
	title = serbia.18.t
	desc = serbia.18.d
	is_triggered_only = yes
	hidden = yes
	immediate = {
		if = {
			limit = {
				FROM = {
					not = {
						has_country_flag = sar_AUH_backed_down
					}
				}
			}
			FRA = { country_event = { id = serbia.19 hours = 1 } }
			RUS = { country_event = { id = serbia.19 hours = 1 } }
			every_country = {
				limit = {
					not = {
						tag = FRA
						tag = RUS
					}
					has_country_flag = friend_of_serbia
				}
				country_event = { id = serbia.19 hours = 1 }
			}
		}
	}
	option = {
		name = serbia.18.a
	}
}
		

#serbia automatically seeks allies; events for countries

country_event = {
	id = serbia.19
	title = serbia.19.t
	is_triggered_only = yes
	desc = {
		text = serbia.19.d1
		trigger = { tag = RUS }
	}
	desc = {
		text = serbia.19.d2
		trigger = { not = { tag = RUS } }
	}
	option = { #yes - guarantee
		name = serbia.20.a
		trigger = {
			not = { has_country_flag = support_aus }
		}
		give_guarantee = FROM
		set_country_flag = support_ser
		AUH = { add_opinion_modifier = { modifier = mor_backs_other_side target = ROOT } }
		SER = { country_event = { id = serbia.20 days = 1 } }
		ai_chance = { factor = 1 }
	}
	option = { #no
		name = serbia.20.b
		SER = { add_opinion_modifier = { modifier = sar_betrayal target = ROOT } }
		SER = { country_event = { id = serbia.21 days = 1 } }
		ai_chance = {
			factor = 0
			modifier = {
				has_country_flag = support_aus
				factor = 1
			}
		}
	}
}

#serbia recieves positive reply
country_event = {
	id = serbia.20
	title = serbia.20.t
	desc = serbia.20.d
	is_triggered_only = yes
	option = {
		name = serbia.20.a
	}
}

#serbia recieves negative reply
country_event = {
	id = serbia.21
	title = serbia.21.t
	desc = serbia.21.d
	is_triggered_only = yes
	option = {
		name = serbia.21.a
	}
}

#italy declines offer
country_event = {
	id = serbia.22
	title = serbia.22.t
	is_triggered_only = yes
	fire_only_once = yes
	desc = {
		text = serbia.22.d1
		trigger = { not = { has_global_flag = sarajevo_AUH_at_war } }
	}
	desc = {
		text = serbia.22.d2
		trigger = { has_global_flag = sarajevo_AUH_at_war }
	}
	option = {
		name = serbia.22.a
	}
}

#Austria-Hungary is told Italy accepted
country_event = {
	id = serbia.23
	title = serbia.23.t
	is_triggered_only = yes
	fire_only_once = yes
	desc = {
		text = serbia.23.d1
		trigger = { not = { has_war_with = SER } }
	}
	desc = {
		text = serbia.23.d2
		trigger = { has_war_with = SER }
	}
	immediate = {
		add_timed_idea = {
			idea = dissatisfied_public
			days = 100
		}
	}
	option = {
		name = serbia.23.a
	}
}
			
# Austria-Hungary drafts ultimatum
country_event = {
	id = serbia.24
	title = serbia.24.t
	desc = serbia.24.d
	is_triggered_only = yes
	fire_only_once = yes
	option = { #extreme demands
		name = serbia.24.a
		set_global_flag = sarajevo_AUH_extreme_demands
		country_event = { id = serbia.25 days = 7 }
		ai_chance = { factor = 0 }
	}
	option = { #harsh demands
		name = serbia.24.b
		set_global_flag = sarajevo_AUH_harsh_demands
		country_event = { id = serbia.25 days = 7 }
		ai_chance = { factor = 1 }
	}
	option = { #mild demands
		name = serbia.24.c
		set_global_flag = sarajevo_AUH_mild_demands
		country_event = { id = serbia.25 days = 7 }
		ai_chance = { factor = 0 }
	}
}

# Austria-Hungary finishes ultimatum
country_event = {
	id = serbia.25
	title = serbia.25.t
	is_triggered_only = yes
	fire_only_once = yes
	desc = {
		text = serbia.25.d1
		trigger = { has_global_flag = sarajevo_AUH_extreme_demands }
	}
	desc = {
		text = serbia.25.d2
		trigger = { has_global_flag = sarajevo_AUH_harsh_demands }
	}
	desc = {
		text = serbia.25.d3
		trigger = { has_global_flag = sarajevo_AUH_mild_demands }
	}
	option = { # send it
		name = serbia.25.a
		SER = { country_event = { id = serbia.26 days = 1 } }
		news_event = { id = sar_news.5 hours = 6 }
		if = {
			limit = { has_global_flag = sarajevo_AUH_extreme_demands }
			every_country = {
				limit = {
					NOT = {
						is_in_faction_with = ROOT
						has_country_flag = support_aus
						tag = SER
						AND = {
							has_idea = triple_alliance
							ROOT = { has_idea = triple_alliance }
						}
					}
				}			
				add_opinion_modifier = { modifier = sar_draconian_demands target = ROOT }
			}
			SER = { add_opinion_modifier = { modifier = sar_draconian_demands_on_us target = ROOT } }
		}	
		if = {
			limit = { has_global_flag = sarajevo_AUH_harsh_demands }
			every_country = {
				limit = {
					NOT = {
						is_in_faction_with = ROOT
						has_country_flag = support_aus
						tag = SER
						AND = {
							has_idea = triple_alliance
							ROOT = { has_idea = triple_alliance }
						}
					}
				}			
				add_opinion_modifier = { modifier = sar_harsh_demands target = ROOT }
			}
			SER = { add_opinion_modifier = { modifier = sar_harsh_demands_on_us target = ROOT } }
		}
		if = {
			limit = { has_global_flag = sarajevo_AUH_mild_demands }
			SER = { add_opinion_modifier = { modifier = sar_mild_demands_on_us target = ROOT } }
		}
		ai_chance = { factor = 1 }
	}
	option = { #no ultimatum
		name = serbia.25.b
		add_timed_idea = {
			idea = nation_humiliated
			days = 200
		}
		ai_chance = { factor = 0 }
	}
}

#Serbia recieves Ultimatum
country_event = {
	id = serbia.26
	title = serbia.26.t
	is_triggered_only = yes
	fire_only_once = yes
	desc = {
		text = serbia.26.d1
		trigger = { has_global_flag = sarajevo_AUH_extreme_demands }
	}
	desc = {
		text = serbia.26.d2
		trigger = { has_global_flag = sarajevo_AUH_harsh_demands }
	}
	desc = {
		text = serbia.26.d3
		trigger = {
			has_global_flag = sarajevo_AUH_mild_demands
			not = { has_global_flag = sarajevo_serbian_support }
		}
	}
	desc = {
		text = serbia.26.d4
		trigger = {
			has_global_flag = sarajevo_AUH_mild_demands
			has_global_flag = sarajevo_serbian_support
		}
	}
	option = { #accept terms
		name = serbia.26.a
		AUH = {
			country_event = { id = serbia.27 days = 1 }
			add_opinion_modifier = { modifier = mor_accepted_terms target = ROOT }
			if = { #extreme terms
				limit = {
					has_global_flag = sarajevo_AUH_extreme_demands
				}
				if = {
					limit = {
						not = { has_dlc = "Together for Victory" }
					}
					puppet = ROOT
				}	
				if = { #sets protectorate if TFV dlc enabled
					limit = { has_dlc = "Together for Victory" }
					set_autonomy = { 
						target = ROOT
						autonomy_state = autonomy_puppet #possibly replace with newly created level?
						freedom_level = 0.3
					}
				}
				set_state_owner = 107
				set_state_controller = 107
				#new country leader for serbia
			}
			if = { #harsh terms
				limit = {
					has_global_flag = sarajevo_AUH_harsh_demands
				}
				if = {
					limit = {
						not = { has_dlc = "Together for Victory" }
					}
					puppet = ROOT
				}	
				if = { #sets protectorate if TFV dlc enabled
					limit = { has_dlc = "Together for Victory" }
					set_autonomy = { 
						target = ROOT
						autonomy_state = autonomy_colony #possibly replace with newly created level?
						freedom_level = 0.7
					}
				}
			}
			if = { #mild terms
				limit = {
					has_global_flag = sarajevo_AUH_mild_demands
				}
				#remove army leaders
				if = {
					limit = {
						has_global_flag = sarajevo_no_catch
					}
					random_list = {
						50 = {
							clr_global_flag = sarajevo_no_catch
							set_global_flag = sarajevo_serbians_caught
						}
						50 = {}
					}
				}
				# trigger event for investigation
			}
		}
		# add non-agression pact ser-aus?
		ai_chance = { factor = 0 }
	}
	option = { #refuse
		name = serbia.26.b
		AUH = {
			add_opinion_modifier = { modifier = mor_defiant target = ROOT }
			country_event = { id = serbia.28 days = 1 }
		}
		ai_chance = { factor = 1 }
	}
}

# austria-hungary recieves positive reply
country_event = {
	id = serbia.27
	title = serbia.27.t
	is_triggered_only = yes
	desc = {
		text = serbia.27.d1
		trigger = { has_global_flag = sarajevo_AUH_extreme_demands }
	}
	desc = {
		text = serbia.27.d2
		trigger = { has_global_flag = sarajevo_AUH_harsh_demands }
	}	
	desc = {
		text = serbia.27.d3
		trigger = { has_global_flag = sarajevo_AUH_mild_demands }
	}
	option = {
		name = serbia.27.a
		trigger = {
			not = { has_global_flag = sarajevo_AUH_mild_demands }
		}
	}
	option = {
		name = serbia.27.b
		trigger = {
			has_global_flag = sarajevo_AUH_mild_demands
		}
	}
}

#austria-hungary recieves negative reply
country_event = {
	id = serbia.28
	title = serbia.28.t
	desc = serbia.28.d
	is_triggered_only = yes
	option = { #war
		name = serbia.28.a
		declare_war_on = {
			target = SER
			type = puppet_wargoal_focus
		}
		SER = { country_event = { id = serbia.5 days = 1 } }
		every_country = {
			limit = { has_country_flag = support_aus }
			country_event = { id = serbia.34 days = 1 }
		}
		country_event = { id = serbia.4 days = 1 }
		ai_chance = { factor = 1 }
	}
	option = { #no war
		name = serbia.28.b
		add_timed_idea = {
			idea = nation_humiliated
			days = 200
		}
		ai_chance = { factor = 0 }
	}
}

#immediate war joining on austro hungarian side
country_event = {
	id = serbia.29
	title = serbia.29.t
	desc = serbia.29.d
	is_triggered_only = yes
	option = {#yes immediately
		name = serbia.29.a
		AUH = {
			ROOT = {
				add_to_war = {
					targeted_alliance = PREV
					enemy = SER
				}
			}
		}
		add_ideas = sar_disorganized_army_5
		country_event = { id = serbia.40 days = 20 }
		ai_chance = { factor = 0 }
	}
	
	option = {#war has to wait, we must mobilize
		name = serbia.29.b
		country_event = { id = serbia.34 days = 21 }
		ai_chance = { factor = 1 }
	}
}

#response to Serbian call to arms
country_event = {
	id = serbia.30
	title = serbia.30.t
	desc = {
		text = serbia.30.d1
		trigger = {
			tag = FRA
			GER = {
				OR = {
					has_country_flag = support_aus
					has_country_flag = austrian_ally
					is_in_faction_with = AUH
					has_war_with = SER
				}
			}
		}
	}
	desc = {
		text = serbia.30.d2
		trigger = {
			OR = {
				not = { tag = FRA }
				AND = {
					tag = FRA
					GER = {
						NOT = {
							has_country_flag = support_aus
							has_country_flag = austrian_ally
							is_in_faction_with = AUH
							has_war_with = SER
						}
					}
				}
			}
		}
	}
	is_triggered_only = yes
	option = {#war now
		name = serbia.30.a
		SER = {
			ROOT = {
				add_to_war = {
					targeted_alliance = PREV
					enemy = AUH
				}
			}
			country_event = { id = serbia.32 days = 1 }
		}
		add_timed_idea = {
			idea = sar_disorganized_army_4
			days = 150
		}
		country_event = { id = serbia.40 days = 25 }
		if = {
			limit = {
				tag = FRA
				GER = {
					OR = {
						has_country_flag = support_aus
						has_country_flag = austrian_ally
						is_in_faction_with = AUH
						has_war_with = SER
					}
				}
			}
			add_ideas = sar_patriotic_wave_4
			country_event = {
				id = serbia.7 days = 60
			}
		}
		if = {
			limit = {
				OR = {
					not = { tag = FRA }
					AND = {
						tag = FRA
						GER = {
							NOT = {
								has_country_flag = support_aus
								has_country_flag = austrian_ally
								is_in_faction_with = AUH
								has_war_with = SER
							}
						}
					}
				}
			}
			add_ideas = sar_patriotic_wave_3
			country_event = {
				id = serbia.7 days = 60
			}
		}
			
		set_country_flag = immediate_war
		set_country_flag = support_ser
		AUH = { country_event = { id = serbia.35 days = 3 } }
		ai_chance = { factor = 0 }
	}
	option = {#delayed war
		name = serbia.30.b
		country_event = { id = serbia.34 days = 21 }
		set_country_flag = mobilizing
		set_country_flag = support_ser
		SER = { country_event = { id = serbia.32 days = 1 } }
		AUH = { country_event = { id = serbia.35 days = 5 } }
		ai_chance = { factor = 1 }
	}
# 	option = {#send volunteers }
#	option = {#send weapons }
	option = {# no war
		name = serbia.30.f
		SER = {
			country_event = { id serbia.33 days = 1 }
			add_opinion_modifier = { modifier = sar_betrayal target = ROOT }
		}
		ai_chance = { factor = 0 }
	}
}

#betrayal; broken agreement
country_event = {
	id = serbia.31
	title = serbia.31.t
	desc = serbia.31.d
	is_triggered_only = yes
	option = { name = serbia.31.a }
}

#country supports serbia
country_event = {
	id = serbia.32
	title = serbia.32.t
	is_triggered_only = yes
	desc = {
		text = serbia.32.d1
		trigger = {
			FROM = { has_country_flag = immediate_war }
		}
	}
	desc = {
		text = serbia.32.d2
		trigger = {
			FROM = { has_country_flag = delayed_war }
		}
	}
#	extra desc for weapons and volunteers
	option = { name = serbia.32.a }
}

#no support for serbia
country_event = {
	id = serbia.33
	title = serbia.33.t
	desc = serbia.33.d
	is_triggered_only = yes
	option = { name = serbia.33.a}
}

#army ready
country_event = {
	id = serbia.34
	title = serbia.34.t
	is_triggered_only = yes
	desc = {
		text = serbia.34.d1
		trigger = { has_country_flag = support_aus }
	}
	desc = {
		text = serbia.34.d2
		trigger = { has_country_flag = support_ser }
	}
	is_triggered_only = yes
	option = { #war
		name = serbia.34.a
		if = {
			limit = { has_country_flag = support_ser }
			add_to_war = {
				targeted_alliance = SER
				enemy = AUH
			}
			if = {
				limit = {
					tag = FRA
					GER = {
						OR = {
							has_country_flag = support_aus
							has_country_flag = austrian_ally
							is_in_faction_with = AUH
							has_war_with = SER
						}
					}
				}
				add_ideas = sar_patriotic_wave_3
				country_event = {
					id = serbia.7 days = 60
				}
			}
			if = {
				limit = {
					OR = {
						not = { tag = FRA }
						AND = {
							tag = FRA
							GER = {
								NOT = {
									has_country_flag = support_aus
									has_country_flag = austrian_ally
									is_in_faction_with = AUH
									has_war_with = SER
								}
							}
						}
					}
				}
				add_ideas = sar_patriotic_wave_2
				country_event = {
					id = serbia.7 days = 60
				}
			}
		}
		if = {
			limit = { has_country_flag = support_aus }
			add_to_war = {
				targeted_alliance = AUH
				enemy = SER
			}
			if = {
				limit = {
					tag = GER
					FRA = {
						OR = {
							has_country_flag = support_ser
							is_in_faction_with = SER
							has_war_with = AUH
						}
					}
				}
				add_ideas = sar_patriotic_wave_3
				country_event = {
					id = serbia.7 days = 60
				}
			}
			if = {
				limit = {
					OR = {
						not = { tag = GER }
						AND = {
							tag = GER
							GER = {
								NOT = {
									has_country_flag = support_ser
									is_in_faction_with = SER
									has_war_with = AUH
								}
							}
						}
					}
				}
				add_ideas = sar_patriotic_wave_2
				country_event = {
					id = serbia.7 days = 60
				}
			}
		}
	ai_chance = { factor = 1 }
	}
	option = { #no war
		name = serbia.34.b
		add_timed_idea = {
			idea = nation_humiliated
			days = 200
		}
		if = {
			limit = { has_country_flag = support_ser }
			SER = {
				country_event = { id = serbia.31 days = 1 }
				add_opinion_modifier = { modifier = sar_betrayal target = ROOT }
			}
		}
		if = {
			limit = { has_country_flag = support_aus }
			AUH = {
				country_event = { id = serbia.31 days = 1 }
				add_opinion_modifier = { modifier = sar_betrayal target = ROOT }
			}
		}
		ai_chance = { factor = 0 }
	}
}

#austrian decision to call for aid if immediate war gets out of control
country_event = {
	id = serbia.35
	is_triggered_only = yes
	fire_only_once = yes
	title = {
		text = serbia.35.t1
		trigger = {
			NOT = {
				has_war_with = RUS
				has_war_with = FRA
				FRA = { has_country_flag = mobilizing }
			}
			RUS = { has_country_flag = mobilizing }
		}
	}
	title = {
		text = serbia.35.t2
		trigger = {
			NOT = {
				has_war_with = RUS
				has_war_with = FRA
				RUS = { has_country_flag = mobilizing }
			}
			FRA = { has_country_flag = mobilizing }
		}
	}
	title = {
		text = serbia.35.t3
		trigger = {
			NOT = {
				has_war_with = RUS
				has_war_with = FRA
			}
			FRA = { has_country_flag = mobilizing }
			RUS = { has_country_flag = mobilizing }
		}
	}
	title = {
		text = serbia.35.t4
		trigger = {
			has_war_with = RUS
			NOT = { has_war_with = FRA }
		}
	}
	title = {
		text = serbia.35.t5
		trigger = {
			has_war_with = FRA
			NOT = { has_war_with = RUS }
		}
	}
	title = {
		text = serbia.35.t6
		trigger = {
			has_war_with = RUS
			has_war_with = FRA
		}
	}
	title = { #backup option
		text = serbia.35.t7
		trigger = {
			NOT = {
				has_war_with = RUS
				has_war_with = FRA
				FRA = { has_country_flag = mobilizing }
				RUS = { has_country_flag = mobilizing }
			}
		}
	}
	desc = {
		text = serbia.35.d1
		trigger = {
			NOT = {
				AUH = { has_war_with = RUS }
				AUH = { has_war_with = FRA }
				FRA = { has_country_flag = mobilizing }
			}
			RUS = { has_country_flag = mobilizing }
		}
	}
	desc = {
		text = serbia.35.d2
		trigger = {
			NOT = {
				AUH = { has_war_with = RUS }
				AUH = { has_war_with = FRA }
				RUS = { has_country_flag = mobilizing }
			}
			FRA = { has_country_flag = mobilizing }
		}
	}
	desc = {
		text = serbia.35.d3
		trigger = {
			NOT = {
				AUH = { has_war_with = RUS }
				AUH = { has_war_with = FRA }
			}
			FRA = { has_country_flag = mobilizing }
			RUS = { has_country_flag = mobilizing }
		}
	}
	desc = {
		text = serbia.35.d4
		trigger = {
			AUH = {
				has_war_with = RUS
				NOT = { has_war_with = FRA }
			}
		}
	}
	desc = {
		text = serbia.35.d5
		trigger = {
			AUH = {
				has_war_with = FRA
				NOT = { has_war_with = RUS }
			}
		}
	}
	desc = {
		text = serbia.35.d6
		trigger = {
			AUH = {
				has_war_with = RUS
				has_war_with = FRA
			}
		}
	}
	desc = { #fallback option
		text = serbia.35.d7
			trigger = {
			NOT = {
				has_war_with = RUS
				has_war_with = FRA
				FRA = { has_country_flag = mobilizing }
				RUS = { has_country_flag = mobilizing }
			}
		}
	}
	option = { #seek support
		name = serbia.35.a
		every_country = {
			limit = {
				not = {
					has_country_flag = support_ser
					tag = ROOT
				}
				OR = {
					has_country_flag = austrian_ally
					AND = {
						ROOT = { has_idea = triple_alliance }
						has_idea = triple_alliance
					}
				}
			}
			country_event = { id = serbia.36 days = 1 }
		}
	}
	option = { #no we can do this - no big war yet
		name = serbia.35.b
		trigger = {
			not = {
				any_country = {
					has_country_flag = is_major_nation
					has_war_with = ROOT
				}
			}
		}
		add_stability = 0.1
	}
	option = { #no we can do this - big war
		name = serbia.35.c
		trigger = {
			any_country = {
				has_country_flag = is_major_nation
				has_war_with = ROOT
			}
		}
		add_stability = 0.1
	}
}		
				
		
country_event = {
	id = serbia.36
	title = serbia.36.t
	is_triggered_only = yes
	desc = {
		text = serbia.36.d1
		trigger = {
			NOT = {
				FROM = {
					has_war_with = RUS
					has_war_with = FRA
				}
				FRA = { has_country_flag = mobilizing }
			}
			RUS = { has_country_flag = mobilizing }
		}
	}
	desc = {
		text = serbia.36.d2
		trigger = {
			NOT = {
				FROM = {
					has_war_with = RUS
					has_war_with = FRA
				}
				RUS = { has_country_flag = mobilizing }
			}
			FRA = { has_country_flag = mobilizing }
		}
	}
	desc = {
		text = serbia.36.d3
		trigger = {
			NOT = {
				FROM = {
					has_war_with = RUS
					has_war_with = FRA
				}
			}
			FRA = { has_country_flag = mobilizing }
			RUS = { has_country_flag = mobilizing }
		}
	}
	desc = {
		text = serbia.36.d4
		trigger = {
			FROM = {
				has_war_with = RUS
				NOT = { has_war_with = FRA }
			}
		}
	}
	desc = {
		text = serbia.36.d5
		trigger = {
			FROM = {
				has_war_with = FRA
				NOT = { has_war_with = RUS }
			}
		}
	}
	desc = {
		text = serbia.36.d6
		trigger = {
			FROM = {
				has_war_with = RUS
				has_war_with = FRA
			}
		}
	}
	desc = {
		text = serbia.36.d7
		trigger = {
			FROM = {
				not = {
					has_war_with = RUS
					has_war_with = FRA
					FRA = { has_country_flag = mobilizing }
					RUS = { has_country_flag = mobilizing }
				}
			}
		}
	}
	option = {#promise support
		name = serbia.36.a
		set_country_flag = support_aus
		country_event = { id = serbia.29 days = 1 }
		#opinion modifier for austria-hungary
		ai_chance = {
			factor = 0 
			modifier = {
				tag = GER
				factor = 1
			}
		}
	}
	option = {#demand territory, for italians
		name = serbia.36.b
		trigger = {
			tag = ITA
		}
		AUH = { country_event = { id = serbia.14 days = 1 } }
		ai_chance = { factor = 1 }
	}
	option = {#refuse
		name = serbia.36.c
		FROM = { country_event = { id = serbia.37 days = 1 } }
		ai_chance = {
			factor = 1 
			modifier = {
				tag = GER
				factor = 0
			}
		}
	}
}

#austria-hungary recieves negative reply

#austria-hungary recieves positive reply
		

#small civil war in austria if they hand over too much land to the italians
country_event = {
	id = serbia.39
	title = serbia.39.t
	desc = serbia.39.d
	is_triggered_only = yes
	fire_only_once = yes
	option = {
		name = serbia.39.a
		start_civil_war = {
			ideology = fascism
			size = 0.15
			capital = 153
			states = { 39 153 102 103 }
			set_equipment_fraction = 0.85
		}
		random_other_country = {
			limit = {
				original_tag = AUH
				ideology = fascism
			}
			set_equipment_fraction = 0.15
			set_stability = 0.6
			set_war_support = 0.6
			set_political_party = {
				ideology = fascism
				popularity = 100
			}
			set_cosmetic_tag = auh_uprising
			set_country_flag = AUH_Rebel
			declare_war_on = {
				target = ITA
				type = take_state
				generator = { 163 736 835 160 }
			}
			set_state_controller = 163
			set_state_controller = 736
			set_state_controller = 835
		ITA = { country_event = { id = serbia.44 hours = 6 } }
	}
}

#housekeeping to make sure affected nation is still at war
country_event = {
	id = serbia.40
	title = serbia.40.t
	desc = serbia.40.d
	is_triggered_only = yes
	hidden = yes
	immediate = {
		if = {
			limit = { has_war = yes }
			country_event = { id = serbia.6 hours = 1 }
		}
	}
	option = {
		name = serbia.40.a
	}
}

#austria-hungary forms their own faction
country_event = {
	id = serbia.41
	title = serbia.41.t
	is_triggered_only = yes
	fire_only_once = yes
	desc = {
		text = serbia.41.d1
		trigger = { is_faction_leader = yes }
	}
	desc = {
		text = serbia.41.d2
		trigger = { is_faction_leader = no }
	}
	option = { #for faction leader
		name = serbia.41.a
		trigger = { is_faction_leader = yes }
	}
	option = {#join austria-hungary
		name = serbia.41.b
		trigger = {
			is_faction_leader = no
			not = {
				has_country_flag = support_ser
				has_country_flag = sar_dissenting_major
			}
		}
		FROM = {
			add_opinion_modifier = {
				modifier = sar_honored_alliance
				target = ROOT
			}
		}
		every_country = {
			limit = {
				is_in_faction_with = ROOT
				is_faction_leader = yes
			}
			add_opinion_modifier = {
				modifier = sar_alliance_breaker
				target = ROOT
			}
		}
		leave_faction = yes
		add_to_faction = FROM
	}
	option = {#stay in faction
		name = serbia.41.c
		trigger = {
			is_faction_leader = no
		}
		every_country = {
			limit = {
				is_in_faction_with = ROOT
				is_faction_leader = yes
			}
			add_opinion_modifier = {
				modifier = sar_honored_alliance
				target = ROOT
			}
		}
		FROM = {
			add_opinion_modifier = {
				modifier = sar_alliance_breaker
				target = ROOT
			}
		}
	}
}
	

#major can leave austro-hungarian faction
country_event = {
	id = serbia.42
	title = serbia.42.t
	desc = serbia.42.d
	is_triggered_only = yes
	immediate = {
		set_country_flag = sar_split_undecided
	}
	option = { #stay in faction
		name = serbia.42.a
		clr_country_flag = sar_dissenting_major
		clr_country_flag = sar_split_undecided
	}
	option = { #leave and form own
		name = serbia.42.b
		country_event = { id = serbia.45 hours = 1 }
		country_event = { id = serbia.46 hours = 2 }
		clr_country_flag = sar_split_undecided
	}
}

#austria-hungary backs down
country_event = {
	id = serbia.43
	title = serbia.43.t
	desc = serbia.43.d
	is_triggered_only = yes
	option = {
		name = serbia.43.a
		trigger = {
			has_country_flag = sar_dissenting_major
		}
		add_opinion_modifier = {
			modifier = sar_listened target = FROM
		}
	}
	option = {
		name = serbia.43.b
		trigger = {
			has_country_flag = support_aus
		}
		add_opinion_modifier = {
			modifier = sar_coward target = FROM
		}
	}
	option = {
		name = serbia.43.c
		trigger = {
			not = {
				has_country_flag = support_aus
				has_country_flag = sar_dissenting_major
			}
		}
	}
}
			

#italians react to austrian uprising
country_event = {
	id = serbia.44
	title = serbia.44.t
	desc = serbia.44.d
	fire_only_once = yes
	is_triggered_only = yes
	option = { name = serbia.44.a }
}

#hidden event for proper faction splitting, set leader
country_event = {
	id = serbia.45
	title = serbia.45.t
	desc = serbia.45.d
	fire_only_once = yes
	is_triggered_only = yes
	hidden = yes
	immediate = {
		leave_faction = yes
		set_rule = { can_create_factions = yes }
		create_faction = "Confederacy of Independent Nations"
		clr_country_flag = sar_dissenting_major
		set_country_flag = CoIN_leader
	}
	option = {
		name = serbia.45.a
	}
}

#hidden event for proper faction splitting, add to new leader
country_event = {
	id = serbia.46
	title = serbia.46.t
	desc = serbia.46.d
	is_triggered_only = yes
	hidden = yes
	immediate = {
		clr_country_flag = sar_dissenting_major
		if = {
			limit = {
				not = { has_country_flag = CoIN_leader }
			}
			leave_faction = yes
			random_other_country = {
				limit = {
					has_country_flag = CoIN_leader
				}
				ROOT = {
					add_to_faction = PREV
				}
			}
		}
	}
	option = {
		name = serbia.46.a
	}
}

#hidden kill switch for ultimatum
country_event = {
    id = serbia.47
    title = serbia.47.t
    desc = serbia.47.d
    is_triggered_only = yes
    fire_only_once = yes
    hidden = yes
    immediate = {
        if = { 
            limit = {
                not = { has_country_flag = sar_AUH_backed_down }
			}
			country_event = { id = serbia.24 hours = 1 }
		}
	}
	option = {
		name = serbia.47.a
	}
}

#general war enthusiasm trigger
country_event = {
	id = serbia.48
	title = serbia.48.t
	is_triggered_only = yes
	#austria-hungary
	desc = { #austria-hungary, vs serbia, high enthusiasm
		text = serbia.48.d1a1
		trigger = {
			tag = AUH
			has_country_flag = sar_high_enthusiasm
			has_war_with = SER
		}
	}
	desc = { #austria-hungary, not vs serbia, high enthusiasm
		text = serbia.48.d1a2
		trigger = {
			tag = AUH
			has_country_flag = sar_high_enthusiasm
			not = { has_war_with = SER }
		}
	}
	desc = { #austria-hungary, vs serbia, medium enthusiasm
		text = serbia.48.d1b1
		trigger = {
			tag = AUH
			has_country_flag = sar_medium_enthusiasm
			has_war_with = SER
		}
	}
	desc = { #austria-hungary, not vs serbia, medium enthusiasm
		text = serbia.48.d1b2
		trigger = {
			tag = AUH
			has_country_flag = sar_medium_enthusiasm
			not = { has_war_with = SER }
		}
	}
	desc = { #austria-hungary, vs serbia, low enthusiasm
		text = serbia.48.d1c1
		trigger = {
			tag = AUH
			has_country_flag = sar_low_enthusiasm
			has_war_with = SER
		}
	}
	desc = { #austria-hungary, not vs serbia, low enthusiasm
		text = serbia.48.d1c2
		trigger = {
			tag = AUH
			has_country_flag = sar_low_enthusiasm
			not = { has_war_with = SER }
		}
	}
	#germany
	desc = { #germany, vs france, high enthusiasm
		text = serbia.48.d2a1
		trigger = {
			tag = GER
			has_country_flag = sar_high_enthusiasm
			OR = {
				has_war_with = FRA
				AND = {
					has_country_flag = support_ser
					FRA = {
						has_country_flag = support_aus
						has_country_flag = mobilizing
					}
				}
				AND = {
					has_country_flag = support_aus
					FRA = {
						has_country_flag = support_ser
						has_country_flag = mobilizing
					}
				}
			}
		}
	}
	desc = { #germany, not vs france, high enthusiasm
		text = serbia.48.d2a2
		trigger = {
			tag = GER
			has_country_flag = sar_high_enthusiasm
			NOT = {
				has_war_with = FRA
				AND = {
					has_country_flag = support_ser
					FRA = {
						has_country_flag = support_aus
						has_country_flag = mobilizing
					}
				}
				AND = {
					has_country_flag = support_aus
					FRA = {
						has_country_flag = support_ser
						has_country_flag = mobilizing
					}
				}
			}
		}
	}
	desc = { #germany, vs france, medium enthusiasm
		text = serbia.48.d2b1
		trigger = {
			tag = GER
			has_country_flag = sar_medium_enthusiasm
			OR = {
				has_war_with = FRA
				AND = {
					has_country_flag = support_ser
					FRA = {
						has_country_flag = support_aus
						has_country_flag = mobilizing
					}
				}
				AND = {
					has_country_flag = support_aus
					FRA = {
						has_country_flag = support_ser
						has_country_flag = mobilizing
					}
				}
			}
		}
	}
	desc = { #germany, not vs france, medium enthusiasm
		text = serbia.48.d2b2
		trigger = {
			tag = GER
			has_country_flag = sar_medium_enthusiasm
			NOT = {
				has_war_with = FRA
				AND = {
					has_country_flag = support_ser
					FRA = {
						has_country_flag = support_aus
						has_country_flag = mobilizing
					}
				}
				AND = {
					has_country_flag = support_aus
					FRA = {
						has_country_flag = support_ser
						has_country_flag = mobilizing
					}
				}
			}
		}
	}
	desc = { #germany, vs france, low enthusiasm
		text = serbia.48.d2c1
		trigger = {
			tag = GER
			has_country_flag = sar_low_enthusiasm
			OR = {
				has_war_with = FRA
				AND = {
					has_country_flag = support_ser
					FRA = {
						has_country_flag = support_aus
						has_country_flag = mobilizing
					}
				}
				AND = {
					has_country_flag = support_aus
					FRA = {
						has_country_flag = support_ser
						has_country_flag = mobilizing
					}
				}
			}
		}
	}
	desc = { #germany, not vs france, low enthusiasm
		text = serbia.48.d2c2
		trigger = {
			tag = GER
			has_country_flag = sar_low_enthusiasm
			NOT = {
				has_war_with = FRA
				AND = {
					has_country_flag = support_ser
					FRA = {
						has_country_flag = support_aus
						has_country_flag = mobilizing
					}
				}
				AND = {
					has_country_flag = support_aus
					FRA = {
						has_country_flag = support_ser
						has_country_flag = mobilizing
					}
				}
			}
		}
	}
	#France
	desc = { #France, vs germany, high enthusiasm
		text = serbia.48.d3a1
		trigger = {
			tag = FRA
			has_country_flag = sar_high_enthusiasm
			OR = {
				has_war_with = GER
				AND = {
					has_country_flag = support_ser
					GER = {
						has_country_flag = support_aus
						has_country_flag = mobilizing
					}
				}
				AND = {
					has_country_flag = support_aus
					GER = {
						has_country_flag = support_ser
						has_country_flag = mobilizing
					}
				}
			}
		}
	}
	desc = { #France, not vs germany, high enthusiasm
		text = serbia.48.d3a2
		trigger = {
			tag = FRA
			has_country_flag = sar_high_enthusiasm
			NOT = {
				has_war_with = GER
				AND = {
					has_country_flag = support_ser
					GER = {
						has_country_flag = support_aus
						has_country_flag = mobilizing
					}
				}
				AND = {
					has_country_flag = support_aus
					GER = {
						has_country_flag = support_ser
						has_country_flag = mobilizing
					}
				}
			}
		}
	}
	desc = { #France, vs germany, medium enthusiasm
		text = serbia.48.d3b1
		trigger = {
			tag = FRA
			has_country_flag = sar_medium_enthusiasm
			OR = {
				has_war_with = GER
				AND = {
					has_country_flag = support_ser
					GER = {
						has_country_flag = support_aus
						has_country_flag = mobilizing
					}
				}
				AND = {
					has_country_flag = support_aus
					GER = {
						has_country_flag = support_ser
						has_country_flag = mobilizing
					}
				}
			}
		}
	}
	desc = { #France, not vs germany, medium enthusiasm
		text = serbia.48.d3b2
		trigger = {
			tag = FRA
			has_country_flag = sar_medium_enthusiasm
			NOT = {
				has_war_with = GER
				AND = {
					has_country_flag = support_ser
					GER = {
						has_country_flag = support_aus
						has_country_flag = mobilizing
					}
				}
				AND = {
					has_country_flag = support_aus
					GER = {
						has_country_flag = support_ser
						has_country_flag = mobilizing
					}
				}
			}
		}
	}
	desc = { #France, vs germany, low enthusiasm
		text = serbia.48.d3c1
		trigger = {
			tag = FRA
			has_country_flag = sar_low_enthusiasm
			OR = {
				has_war_with = GER
				AND = {
					has_country_flag = support_ser
					GER = {
						has_country_flag = support_aus
						has_country_flag = mobilizing
					}
				}
				AND = {
					has_country_flag = support_aus
					GER = {
						has_country_flag = support_ser
						has_country_flag = mobilizing
					}
				}
			}
		}
	}
	desc = { #France, not vs germany, low enthusiasm
		text = serbia.48.d3c2
		trigger = {
			tag = FRA
			has_country_flag = sar_low_enthusiasm
			NOT = {
				has_war_with = GER
				AND = {
					has_country_flag = support_ser
					GER = {
						has_country_flag = support_aus
						has_country_flag = mobilizing
					}
				}
				AND = {
					has_country_flag = support_aus
					GER = {
						has_country_flag = support_ser
						has_country_flag = mobilizing
					}
				}
			}
		}
	}
	#russia
	desc = { #russia, vs austria, high enthusiasm
		text = serbia.48.d4a1
		trigger = {
			tag = RUS
			has_country_flag = sar_high_enthusiasm
			OR = {
				has_war_with = AUH
				has_country_flag = support_ser
			}
		}
	}
	desc = { #russia, not vs austria, high enthusiasm
		text = serbia.48.d4a2
		trigger = {
			tag = RUS
			has_country_flag = sar_high_enthusiasm
			NOT = {
				has_war_with = AUH
				has_country_flag = support_ser
			}
		}
	}
	desc = { #russia, vs austria, medium enthusiasm
		text = serbia.48.d4b1
		trigger = {
			tag = RUS
			has_country_flag = sar_high_enthusiasm
			OR = {
				has_war_with = AUH
				has_country_flag = support_ser
			}
		}
	}
	desc = { #russia, not vs austria, medium enthusiasm
		text = serbia.48.d4b2
		trigger = {
			tag = RUS
			has_country_flag = sar_medium_enthusiasm
			NOT = {
				has_war_with = AUH
				has_country_flag = support_ser
			}
		}
	}
	desc = { #russia, vs austria, low enthusiasm
		text = serbia.48.d4c1
		trigger = {
			tag = RUS
			has_country_flag = sar_low_enthusiasm
			OR = {
				has_war_with = AUH
				has_country_flag = support_ser
			}
		}
	}
	desc = { #russia, not vs austria, low enthusiasm
		text = serbia.48.d4c2
		trigger = {
			tag = RUS
			has_country_flag = sar_low_enthusiasm
			NOT = {
				has_war_with = AUH
				has_country_flag = support_ser
			}
		}
	}
	#britain
	desc = { #britain, for belgium, high enthusiasm
		text = serbia.48.d5a1
		trigger = {
			tag = ENG
			has_country_flag = sar_high_enthusiasm
			has_country_flag = support_belgium
		}
	}
	desc = { #britain, not for belgium, high enthusiasm
		text = serbia.48.d5a2
		trigger = {
			tag = ENG
			has_country_flag = sar_high_enthusiasm
			NOT = { has_country_flag = support_belgium }
		}
	}
	desc = { #britain, for belgium, medium enthusiasm
		text = serbia.48.d5b1
		trigger = {
			tag = ENG
			has_country_flag = sar_medium_enthusiasm
			has_country_flag = support_belgium
		}
	}
	desc = { #britain, not for belgium, medium enthusiasm
		text = serbia.48.d5b2
		trigger = {
			tag = ENG
			has_country_flag = sar_medium_enthusiasm
			NOT = { has_country_flag = support_belgium }
		}
	}
	desc = { #britain, for belgium, low enthusiasm
		text = serbia.48.d5c1
		trigger = {
			tag = ENG
			has_country_flag = sar_low_enthusiasm
			has_country_flag = support_belgium
		}
	}
	desc = { #britain, not for belgium, low enthusiasm
		text = serbia.48.d5c2
		trigger = {
			tag = ENG
			has_country_flag = sar_low_enthusiasm
			NOT = { has_country_flag = support_belgium }
		}
	}
	#italy
	desc = { #italy, vs austria, high enthusiasm
		text = serbia.48.d6a1
		trigger = {
			tag = ITA
			has_country_flag = sar_high_enthusiasm
			OR = {
				has_war_with = AUH
				has_country_flag = support_ser
			}
		}
	}
	desc = { #italy, not vs austria, high enthusiasm
		text = serbia.48.d6a2
		trigger = {
			tag = ITA
			has_country_flag = sar_high_enthusiasm
			NOT = {
				has_war_with = AUH
				has_country_flag = support_ser
			}
		}
	}
	desc = { #italy, vs austria, medium enthusiasm
		text = serbia.48.d6b1
		trigger = {
			tag = ITA
			has_country_flag = sar_medium_enthusiasm
			OR = {
				has_war_with = AUH
				has_country_flag = support_ser
			}
		}
	}
	desc = { #italy, not vs austria, medium enthusiasm
		text = serbia.48.d6b2
		trigger = {
			tag = ITA
			has_country_flag = sar_medium_enthusiasm
			NOT = {
				has_war_with = AUH
				has_country_flag = support_ser
			}
		}
	}
	desc = { #italy, vs austria, low enthusiasm
		text = serbia.48.d6c1
		trigger = {
			tag = ITA
			has_country_flag = sar_low_enthusiasm
			OR = {
				has_war_with = AUH
				has_country_flag = support_ser
			}
		}
	}
	desc = { #italy, not vs austria, low enthusiasm
		text = serbia.48.d6c2
		trigger = {
			tag = ITA
			has_country_flag = sar_low_enthusiasm
			NOT = {
				has_war_with = AUH
				has_country_flag = support_ser
			}
		}
	}
	desc = { #generic, high enthusiasm
		text = serbia.48.d7a
		trigger = {
			has_country_flag = sar_high_enthusiasm
			not = {
				tag = AUH
				tag = GER
				tag = FRA
				tag = RUS
				tag = ENG
				tag = ITA
			}
		}
	}
	desc = { #generic, medium enthusiasm
		text = serbia.48.d7b
		trigger = {
			has_country_flag = sar_medium_enthusiasm
			not = {
				tag = AUH
				tag = GER
				tag = FRA
				tag = RUS
				tag = ENG
				tag = ITA
			}
		}
	}
	desc = { #generic, high enthusiasm
		text = serbia.48.d7c
		trigger = {
			has_country_flag = sar_low_enthusiasm
			not = {
				tag = AUH
				tag = GER
				tag = FRA
				tag = RUS
				tag = ENG
				tag = ITA
			}
		}
	}
	option = { #austria, vs serbia
		name = serbia.48.a
		trigger = {
			tag = AUH
			has_war_with = SER
		}
		if = {
			limit = { has_country_flag = sar_high_enthusiasm }
			add_ideas = sar_patriotic_wave_4
			country_event = { id = serbia.7 days = 60 }
		}
		if = {
			limit = { has_country_flag = sar_medium_enthusiasm }
			add_ideas = sar_patriotic_wave_3
			country_event = { id = serbia.7 days = 60 }
		}
		if = {
			limit = { has_country_flag = sar_low_enthusiasm }
			add_ideas = sar_patriotic_wave_2
			country_event = { id = serbia.7 days = 60 }
		}
	}
	option = { #germany
		name = serbia.48.b
		trigger = {
			tag = GER
		}
		if = {
			limit = { has_country_flag = sar_high_enthusiasm }
			add_ideas = sar_patriotic_wave_4
			country_event = { id = serbia.7 days = 60 }
		}
		if = {
			limit = { has_country_flag = sar_medium_enthusiasm }
			add_ideas = sar_patriotic_wave_3
			country_event = { id = serbia.7 days = 60 }
		}
		if = {
			limit = { has_country_flag = sar_low_enthusiasm }
			add_ideas = sar_patriotic_wave_2
			country_event = { id = serbia.7 days = 60 }
		}
	}
	option = { #france
		name = serbia.48.c
		trigger = {
			tag = FRA
		}
		if = {
			limit = { has_country_flag = sar_high_enthusiasm }
			add_ideas = sar_patriotic_wave_4
			country_event = { id = serbia.7 days = 60 }
		}
		if = {
			limit = { has_country_flag = sar_medium_enthusiasm }
			add_ideas = sar_patriotic_wave_3
			country_event = { id = serbia.7 days = 60 }
		}
		if = {
			limit = { has_country_flag = sar_low_enthusiasm }
			add_ideas = sar_patriotic_wave_2
			country_event = { id = serbia.7 days = 60 }
		}
	}
	option = { #russia
		name = serbia.48.e
		trigger = {
			tag = RUS
		}
		if = {
			limit = { has_country_flag = sar_high_enthusiasm }
			add_ideas = sar_patriotic_wave_4
			country_event = { id = serbia.7 days = 60 }
		}
		if = {
			limit = { has_country_flag = sar_medium_enthusiasm }
			add_ideas = sar_patriotic_wave_3
			country_event = { id = serbia.7 days = 60 }
		}
		if = {
			limit = { has_country_flag = sar_low_enthusiasm }
			add_ideas = sar_patriotic_wave_2
			country_event = { id = serbia.7 days = 60 }
		}
	}
	option = { #britain
		name = serbia.48.f
		trigger = {
			tag = ENG
		}
		if = {
			limit = { has_country_flag = sar_high_enthusiasm }
			add_ideas = sar_patriotic_wave_4
			country_event = { id = serbia.7 days = 60 }
		}
		if = {
			limit = { has_country_flag = sar_medium_enthusiasm }
			add_ideas = sar_patriotic_wave_3
			country_event = { id = serbia.7 days = 60 }
		}
		if = {
			limit = { has_country_flag = sar_low_enthusiasm }
			add_ideas = sar_patriotic_wave_2
			country_event = { id = serbia.7 days = 60 }
		}
	}
	option = { #italy
		name = serbia.48.g
		trigger = {
			tag = ITA
		}
		if = {
			limit = { has_country_flag = sar_high_enthusiasm }
			add_ideas = sar_patriotic_wave_4
			country_event = { id = serbia.7 days = 60 }
		}
		if = {
			limit = { has_country_flag = sar_medium_enthusiasm }
			add_ideas = sar_patriotic_wave_3
			country_event = { id = serbia.7 days = 60 }
		}
		if = {
			limit = { has_country_flag = sar_low_enthusiasm }
			add_ideas = sar_patriotic_wave_2
			country_event = { id = serbia.7 days = 60 }
		}
	}
	option = { #all other
		name = serbia.48.h
		trigger = {
			OR = {
				AND = {
					tag = AUH
					not = { has_war_with = SER }
				}
				NOT = {
					tag = AUH
					tag = GER
					tag = FRA
					tag = RUS
					tag = ENG
					tag = ITA
				}
			}
		}
		if = {
			limit = { has_country_flag = sar_high_enthusiasm }
			add_ideas = sar_patriotic_wave_4
			country_event = { id = serbia.7 days = 60 }
		}
		if = {
			limit = { has_country_flag = sar_medium_enthusiasm }
			add_ideas = sar_patriotic_wave_3
			country_event = { id = serbia.7 days = 60 }
		}
		if = {
			limit = { has_country_flag = sar_low_enthusiasm }
			add_ideas = sar_patriotic_wave_2
			country_event = { id = serbia.7 days = 60 }
		}
	}
}